\section{Introduction}
\label{sec:intro}

Web applications have proliferated because it is so easy for
developers to reuse components of existing ones.  While component
reuse in the venerable desktop software model typically takes the form
of libraries, the reusable components in web applications are not
limited to just JavaScript library code---they further include
network-accessible content and services. Such reuse is
ubiquitous. jQuery, a widely used JavaScript library, is included in
and used by 78\% of the Quantcast top-10,000 web sites, and over 59\%
of the Quantcast top-million web sites~\cite{quantcast}.

The resulting model is one in which web developers cobble together
multiple JavaScript libraries, web-based content, and web-based
services written and operated by various parties (who in turn may
integrate more of these resources) and build the required
application-specific functionality atop them. Unfortunately, some of
the many contributors to the tangle of JavaScript comprising an
application may not have the user's best interest at heart. The wealth
of sensitive data processed in today's web applications (e.g., email,
bank statements, health records, passwords, etc.) is an attractive
target. Miscreants may stealthily craft malicious JavaScript that,
when incorporated into an application by an unwitting developer,
violates the user's privacy by leaking sensitive information.

Two goals for web applications emerge from the prior discussion:
{\em flexibility} for the application developer (i.e., enabling the
building of applications with rich functionality, composable from
potentially disparate pieces hosted by different sites); and {\em
  privacy} for the user (i.e., to ensure that the user's sensitive
data cannot be leaked from applications to unauthorized parties).
These two goals are hardly new: Wang {\em et al.}~articulated similar
ones, and proposed new browser primitives to improve isolation within
{\em mashups,} including discretionary access control (DAC) for inter-frame
communication~\cite{mashupos}. Indeed, today's browsers incorporate
similar mechanisms in the guises of HTML5's seamless iframes, iframe
sandbox, and postMessage API~\cite{html5}. And the Same-Origin Policy
(SOP, reviewed in Section~\ref{sec:backgd}) prevents JavaScript hosted
by one principal from reading content hosted by another.

Unfortunately, in the status-quo web browser security architecture,
one must often sacrifice privacy to achieve flexibility, and
vice-versa. The central reason that flexibility and privacy are at
odds in the status quo is that the mechanisms today's browsers rely on
for providing privacy---the SOP, Content Security Policies
(CSP)~\cite{csp}, and Cross-Origin Resource Sharing
(CORS)~\cite{cors13}---are all forms of discretionary access control
(DAC). DAC has the brittle character of either denying or granting
untrusted code (e.g., a library written by a third party) access to
data. In the former case, the untrusted JavaScript might {\em need}
the sensitive data to implement the desired application
functionality---hence, denying access prioritizes privacy over
flexibility. In the latter, DAC exercises no control over what the
untrusted code does with the sensitive data---and thus prioritizes
flexibility over privacy. DAC is an essential tool in the privacy
arsenal, but {\em does not fit cases where one runs untrusted code on
  sensitive input,} which are the norm for web applications, given
their multi-contributor nature.

In practice, web developers turn their backs on privacy in favor of
flexibility because the browser doesn't offer primitives that let them
opt for both. For example, a developer may want to include untrusted
JavaScript from another origin in his application. All-or-nothing DAC
leads the developer to include the untrusted library with a
\js|<script>| tag, which effectively bypasses the SOP, interpolating
untrusted code into the enclosing page and granting it unfettered
access to the enclosing page's origin's content.\footnote{Indeed,
  jQuery \emph{requires} such access to the enclosing page's content!}
And when a developer of a mashup that integrates content from two {\em
  other} origins finds that the SOP forbids his application from
retrieving data from them, he designs his mashup to require that the
user provide the mashup her login credentials for the sites at the two
other origins~\cite{mint.com}---the epitome of ``functionality over
privacy.''

% When a developer uses these various libraries and services to build
% their application, one might wonder: to whom are we entrusting our
% private data---our email and bank statements, our health records and
% passwords?
%
% Today, a web application trusts all of the parties who wrote and
% operate its dependencies.
% %
% This includes the developers of the libraries it uses and the content
% distribution network that hosts copies of these libraries; it even
% includes browser extensions a user might have installed, which run
% JavaScript written by other parties still.
% %
% From the perspective of a user, if the web application is a mashup---an
% application which integrates the content and services of other web
% sites---they must trust the application itself with the login
% credentials and personal information of the constituent services.

% \Red{This transition is botched} Broadly speaking, we can identify two goals for web applications.
% %
% The first goal is {\em flexibility:\/} developers should be able to
% flexibly compose services, content, and JavaScript code from multiple
% parties into \Red{rich, }featureful web applications.
% %
% The second is {\em privacy:\/} there should be strong guarantees that a
% user's privacy cannot be violated when a web application processes her
% sensitive data.
% %
% These goals are hardly new: \Red{Wang {\em et al.} articulated similar goals
% and proposed new browser primitives to improve isolation within mashups (Brad mentioned something about this giving too much deference to mashup-os. I don't know how to fix ezyang):}
% sandboxes that allow pages not to share their data with JavaScript code
% they include and discretionary access control (DAC) for inter-frame
% communication~\cite{mashupos}.
% %
% Indeed, today's browsers incorporate similar mechanisms, including
% HTML5's seamless iframes, iframe sandbox, and postMessage
% API~\cite{html5}.
% %
% And of course, the well-known Same-Origin Policy prevents JavaScript
% hosted by one principal from reading content hosted by another.

% Unfortunately, efforts to advance one of these two goals still often hamper achieving
% the other. Application developers (and users) are thus often left with
% only unpalatable choices (though in practice, the desire for
% functionality often dominates the concern for privacy).
% %
% At the moment, browsers only enforce privacy by applying discretionary
% access control when an untrusted script wishes to read potentially
% sensitive data.
% %
% These various isolation mechanisms (e.g., the SOP and Content Security Policies (CSP)) tend
% to be ``all-or-nothing'', thwarting the implementation
% of many useful mashups.
% %
% DAC can only deny or grant
% untrusted JavaScript access to the sensitive data; it cannot
% dictate what happens to the data afterwards.
% %
% The only way to avoid trusting a service with secret data is never to give
% it that data in the first place, but applications like password
% managers or a personal finance organizers (e.g., {\tt mint.com}) require
% sensitive data to implement their functionality.

% \todo{ezyang}{I think section is too long and could be trimmed down}
% Modern browsers also incorporate mechanisms that explicitly support
% the prioritization of flexibility over privacy. For example, an
% application developer may choose to include JavaScript from another
% origin with a {\tt <script>} tag, which effectively bypasses the SOP,
% interpolating the untrusted script into the enclosing page and
% granting the script unfettered access to the enclosing page's origin's
% content. Or a web server's operator may use Cross-Origin Resource
% Sharing to
% explicitly enumerate other origins permitted to read content from that
% server (bypassing the SOP for those other origins).
% This approach still limits flexibility, though, in that it requires a
% server's operator to know {\em a priori} which mashups are hosted by
% which other origins, and worse, potentially allows a service provider
% to limit users' choice of applications that integrate content from the
% provider's site.\footnote{The user has the further unpalatable
%   choice of providing her login credentials for the service
%   provider's site to the web application---a potential
%   privacy and integrity disaster for, say, one's online banking site,
%   yet the precise model that services like {\tt mint.com} use for lack
%   of a better alternative.} This, of course, also potentially sacrifices
% privacy, because the other origins are typically operated by other
% principals who may in turn leak any sensitive information they
% receive.

In this paper, we present \sys{} (Confinement with Origin Web Labels),
a mandatory access control (MAC) system that confines untrusted
Javascript in web browsers. \sys{} allows untrusted code to compute
over sensitive data and display results to the user, but prohibits the
untrusted code from exfiltrating sensitive data (e.g., by sending it
to an untrusted remote origin). It thus allows web developers to opt
for {\em both} flexibility and privacy.

We consider four motivating example web ap\-pli\-ca\-tions---a
password strength-checker, an application that imports the (untrusted)
jQuery library, an encrypted cloud-based document editor, and a
third-party mashup, none of which can be implemented in a way that
preserves the user's privacy in the status-quo web security
architecture. These examples drive the design requirements for \sys{},
particularly MAC with {\em symmetric and hierarchical confinement.}
Symmetric confinement allows {\em mutually} distrusting principals
each to pass sensitive data to the other, and confine the other's use
of the passed sensitive data. And hierarchical confinement allows any
developer to confine code she does not trust, and confinement to be
nested to arbitrary depths.
%
% To offer the greatest flexibility to web application developers, the
% means of confinement should further be \emph{first class,} in that any
% container (e.g., a frame) should be able to prevent untrusted code
% incorporated in a sub-container from exfiltrating sensitive data passed
% into the sub-container, with arbitrarily deep nesting, e.g., so that a
% page may include a library it does not trust, and that library may in
% turn include another library \emph{it} does not trust.
% %
% And finally, also in the interest of flexibility, the means of
% confinement should be \emph{symmetric,} in that it should allow each
% principal on either side of a trust boundary to pass sensitive data to
% the other, while preventing the other principal from exfiltrating it.  
% %
% This property, for instance, ensures that the parent of a
% sub-container cannot arbitrarily exfiltrate data it receives from the
% sub-container.
% %
No prior browser security architecture offers this combination of
properties.

% In this paper, we present \sys{} (the Secure Web API), a simple,
% label-based mandatory access control (MAC) system for web browsers
% that delivers both flexibility for web application developers and
% %robust 
% privacy for users. \sys{} allows untrusted JavaScript to
% process sensitive data, and confines the untrusted JavaScript in
% first-class, symmetric fashion.

We demonstrate the applicability of \sys{} by using it to implement
secure versions of the four motivating applications.
%  To illustrate the value of these
% properties, we present four case-study applications--- none of which can be realized
% without the browser modifications described in this paper.  We then
% present implementations of these applications atop \sys.
Our contributions include:

\begin{CompactItemize}
\item We characterize four case-study web applications
  (Section~\ref{sec:motivating-examples}) for which today's browser security
  architecture cannot provide privacy.
%strong 
\item We describe the design of the \sys{} label-based MAC system
  for web browsers (Section~\ref{sec:system}), which meets the
  requirements of the four case-study web applications.
\item We describe designs of the four case-study web applications atop
  \sys.
\item We describe implementations of \sys{}
  (Section~\ref{sec:implementation}) for the Firefox and Chromium
  open-source browsers; our evaluation (Section~\ref{sec:eval})
  illustrates that \sys{} incurs minimal performance overhead over the
  respective baseline browsers.
\end{CompactItemize}

% Local Variables:
% TeX-master: "main.ltx"
% TeX-command-default: "Make"
% End:
