\section{Introduction}
\label{sec:intro}

Web applications have proliferated because of the ease by which
developers can reuse components of existing web applications.
%
While component reuse in the venerable desktop software model typically
takes the form of libraries, the reusable components in web applications
aren't limited to just JavaScript library code---they include
network-accessible content and services.
%
This reuse is ubiquitous\@: jQuery, a widely used JavaScript
library, is included in and used by 78\% of the Quantcast top-10,000
web sites, and over 59\% of the Quantcast top-million web
sites~\cite{quantcast}.

When a developer uses these various libraries and services to build
their application, one might wonder: to whom are we entrusting our
private data---our email and bank statements, our health records and
passwords?
%
Today, a web application trusts all of the parties who wrote and
operate its dependencies.
%
This includes the developers of the libraries it uses and the content
distribution network that hosts copies of these libraries; it even
includes browser extensions a user might have installed, which run
JavaScript written by other parties still.
%
From the perspective of a user, if the web application is a mashup---an
application which integrates the content and services of other web
sites---they must trust the application itself with the login
credentials and personal information of the constituent services.

\Red{This transition is botched} Broadly speaking, we can identify two goals for web applications.
%
The first goal is {\em flexibility:\/} developers should be able to
flexibly compose services, content, and JavaScript code from multiple
parties into \Red{rich, }featureful web applications.
%
The second is {\em privacy:\/} there should be strong guarantees that a
user's privacy cannot be violated when a web application processes her
sensitive data.
%
These goals are hardly new: \Red{Wang {\em et al.} articulated similar goals
and proposed new browser primitives to improve isolation within mashups (Brad mentioned something about this giving too much deference to mashup-os. I don't know how to fix ezyang):}
sandboxes that allow pages not to share their data with JavaScript code
they include and discretionary access control (DAC) for inter-frame
communication~\cite{mashupos}.
%
Indeed, today's browsers incorporate similar mechanisms, including
HTML5's seamless iframes, iframe sandbox, and postMessage
API~\cite{html5}.
%
And of course, the well-known Same-Origin Policy prevents JavaScript
hosted by one principal from reading content hosted by another.

\Red{This paragraph tries to explain what restrictions are imposed}
Unfortunately, efforts to advance one of these two goals still often hamper achieving
the other. Application developers (and users) are thus often left with
only unpalatable choices (though in practice, the desire for
functionality often dominates the concern for privacy).
%
At the moment, browsers only enforce privacy by applying discretionary
access control when an untrusted script wishes to read potentially
sensitive data.
%
These various isolation mechanisms (e.g., the SOP and Content Security Policies (CSP)) tend
to be ``all-or-nothing'', thwarting the implementation
of many useful mashups.
%
DAC can only deny or grant
untrusted JavaScript access to the sensitive data; it cannot
dictate what happens to the data afterwards.
%
The only way to avoid trusting a service with secret data is never to give
it that data in the first place, but applications like password
managers or a personal finance organizers (e.g., {\tt mint.com}) require
sensitive data to implement their functionality.

\Red{This section tries to explain what flexibilities are allowed. I think
it is too long and could be trimmed down}
Modern browsers also incorporate mechanisms that explicitly support
the prioritization of flexibility over privacy. For example, an
application developer may choose to include JavaScript from another
origin with a {\tt <script>} tag, which effectively bypasses the SOP,
interpolating the untrusted script into the enclosing page and
granting the script unfettered access to the enclosing page's origin's
content. Or a web server's operator may use Cross-Origin Resource
Sharing to
explicitly enumerate other origins permitted to read content from that
server (\Red{bypassing the SOP for those other origins}).
This approach still limits flexibility, though, in that it requires a
server's operator to know {\em a priori} which mashups are hosted by
which other origins, and worse, potentially allows a service provider
to limit users' choice of applications that integrate content from the
provider's site.\footnote{The user has the further unpalatable
  choice of providing her login credentials for the service
  provider's site to the web application---a potential
  privacy and integrity disaster for, say, one's online banking site,
  yet the precise model that services like {\tt mint.com} use for lack
  of a better alternative.} This, of course, also potentially sacrifices
privacy, because the other origins are typically operated by other
principals who may in turn leak any sensitive information they
receive.

To achieve both flexibility and privacy, what is needed is a means to
allow untrusted code to compute over sensitive data and display
results to the user, while \emph{confining} the untrusted code so that
it may not exfiltrate the sensitive data (e.g., by sending it to an untrusted remote
origin).
%
To offer the greatest flexibility to web application developers, the
means of confinement should further be \emph{first class,} in that any
container (e.g., a frame) should be able to prevent untrusted code
incorporated in a sub-container from exfiltrating sensitive data passed
into the sub-container, with arbitrarily deep nesting, e.g., so that a
page may include a library it does not trust, and that library may in
turn include another library \emph{it} does not trust.
%
And finally, also in the interest of flexibility, the means of
confinement should be \emph{symmetric,} in that it should allow each
principal on either side of a trust boundary to pass sensitive data to
the other, while preventing the other principal from exfiltrating it.  
%
This property, for instance, ensures that the parent of a
sub-container cannot arbitrarily exfiltrate data it receives from the
sub-container.
%
No existing combination of browser security mechanisms offers these
properties.

In this paper, we present \sys{} (the Secure Web API), a simple,
label-based mandatory access control (MAC) system for web browsers
that delivers both flexibility for web application developers and
robust privacy for users. \sys{} allows untrusted JavaScript to
process sensitive data, and confines the untrusted JavaScript in
first-class, symmetric fashion.  To illustrate the value of these
properties, we present five case-study applications---a password
strength-checker, a password manager, a banking application that uses
the (untrusted) jQuery library, a ``phone numbers-to-links'' browser
extension, and a third-party mashup, none of which can be realized
without the browser modifications described in this paper.  We then
present implementations of these applications atop \sys. Our
contributions include:

\begin{CompactItemize}
\item We characterize five case-study web applications
  (Section~\ref{sec:goals}) for which today's browser security
  architecture cannot provide strong privacy.
\item We describe the design of the \sys{} label-based MAC system
  for web browsers (Section~\ref{sec:system}), which meets the
  requirements of the five case-study web applications.
\item We describe designs of the five case-study web applications atop
  \sys.
\item We describe the implementation of \sys{}
  (Section~\ref{sec:implementation}) and evaluate the performance
  overhead in the Firefox and Chromium open-source browsers; our
  evaluation (Section~\ref{sec:eval}) illustrates that \sys{} incurs
  minimal performance overhead over the respective baseline browsers.
\end{CompactItemize}

% Local Variables:
% TeX-master: "main.ltx"
% TeX-command-default: "Make"
% End:
